name: Build and Deploy BirthdayBuddyLeftChatBot

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on:
      group: TelegramBotRunners
    environment: production

    steps:
      - name: üîÅ –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
        uses: actions/checkout@v4
        # ‚Üí –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—Å–µ —Ñ–∞–π–ª—ã –µ—Å—Ç—å –≤ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (Runner —Å–æ–∑–¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ä–∞–±–æ—á—É—é –ø–∞–ø–∫—É /home/runner/actions-runner/_work/BirthdayBuddyLeftChat/BirthdayBuddyLeftChat)

      - name: ‚öôÔ∏è –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ .NET –∏ –µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: üõ†Ô∏è –®–∞–≥ 3: –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
        run: cd BirthdayBuddyLeftChat & dotnet restore

      - name: üõ†Ô∏è –®–∞–≥ 4: –°–æ–±–∏—Ä–∞–µ–º –∏ –ø—É–±–ª–∏–∫—É–µ–º
        run: |
          dotnet publish \
          --configuration Release \
          --output ./publish \
          --nologo \
          --verbosity minimalse

      - name: üìÅ –®–∞–≥ 5: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        run: #cp Settings.json ./publish/ || echo "Warning: Settings.json –Ω–µ –Ω–∞–π–¥–µ–Ω!"

      - name: üöÄ –®–∞–≥ 6: –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        run: |
          # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
          # scp -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa -r ./publish/* root@telegram.local:/root/publish/BirthdayBuddyLeftChat/

      - name: üîÅ –®–∞–≥ 7: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
        run: systemctl restart BirthdayBuddyLeftChat.service

      - name: üöÄ –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞
        run: systemctl status BirthdayBuddyLeftChat.service --no-pager
